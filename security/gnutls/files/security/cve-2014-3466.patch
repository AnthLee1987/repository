From 7906c3dad6a06c7bad15606d7d8772ef79539897 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey.doherty@gmail.com>
Date: Sun, 6 Jul 2014 16:31:36 +0100
Subject: [PATCH] CVE-2014-3466: Backport upstream fixes

Buffer overflow in the read_server_hello function in lib/gnutls_handshake.c
in GnuTLS before 3.1.25, 3.2.x before 3.2.15, and 3.3.x before 3.3.4 allows
remote servers to cause a denial of service (memory corruption) or possibly
execute arbitrary code via a long session id in a ServerHello message.

Signed-off-by: Ikey Doherty <ikey.doherty@gmail.com>
---
 lib/gnutls_handshake.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/gnutls_handshake.c b/lib/gnutls_handshake.c
index 39b67ee..76c26a9 100644
--- a/lib/gnutls_handshake.c
+++ b/lib/gnutls_handshake.c
@@ -1657,7 +1657,7 @@ _gnutls_read_server_hello (gnutls_session_t session,
   DECR_LEN (len, 1);
   session_id_len = data[pos++];
 
-  if (len < session_id_len)
+  if (len < session_id_len || session_id_len > TLS_MAX_SESSION_ID_SIZE)
     {
       gnutls_assert ();
       return GNUTLS_E_UNSUPPORTED_VERSION_PACKET;
-- 
1.9.1

